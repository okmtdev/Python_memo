# モジュール

ファイルに定義を仕込んでスクリプトや対話セッションで使う手段としてモジュールが用意されている

フィボナッチ数のモジュール

```
def fib(n):
    a, b = 0, 1
    while a < n:
        print(a, end=' ')
        a, b = b, a+b
    print()
```

呼び出し方

```
import fibo

fibo.fib(1000)
```

モジュールには関数定義のほか、実行可能な文を入れることができる

モジュールを使う側でimport文によりモジュール名に初めて遭遇したときだけ実行される

名前を指定して取り込む

```
from fibo import fib, fib2
```

モジュールが定義する名前を取り込む

```
from fibo import *
```

しかし、アンダースコアで始まる以外のものが対象

Pythonモジュールを以下のように実行すると、

```
python fibo.py 引数
```

モジュール中のコードはimport時に同様に実行される

ただしその__name__は__main__となる

以下のようなコードをモジュール末尾に追加することにより、ファイルをスクリプトとしてもimport可能なモジュールとしても使える

```
if __name__ == '__main__':
    import sys
    fib(int(sys.argv[1]))
```

モジュールとしてインポートされたときは上記のコードは走らない

モジュールの探索パス

- 入力スクリプトのあるディレクトリ（ファイル名が指定されていないときはカレントディレクトリ）
- PYTHONPATH（ディレクトリ名のリスト。構文はシェル変数PATHと同じ）
- インストールごとのデフォルト

コンパイル済みPythonファイル

モジュール読み込みの高速化のためにPythonはコンパイル済みのモジュールを`__pycache__`ディレクトリに「module.バージョン名.pyc」の名前でキャッシュする

この命名規則により、異なるリリース、異なるバージョンのPythonでコンパイルされたモジュール同士が共存できるようになっている

小技

- コマンドラインから起動するコマンドに-0や-00のスイッチを使うとコンパイル済みモジュールファイルのサイズを小さくすることができる
- 最適化された.pycファイルから読み込まれたプログラムも、.pyファイルから読み込まれた時に比べて動作が早くなるわけではない。.pycにしておけば読み込みが早いだけ
- compileallモジュールを使うと、ディレクトリのモジュール全ての.pycファイルが生成できる（詳しくはPRP 3147を参照）

dir()関数


```
import fibo
dir(fibo)
```

モジュールが定義している名前を確認するのに利用する

戻り値は文字列のリストで、ソート済み

dir()はビルトインの関数名と変数名をリストアップしない。それらは標準モジュールbuiltinsで定義されている

```
import builtins
dir(builtins)
```

パッケージとはドット区切りのモジュール名

下記を参照

https://rinatz.github.io/python-book/ch04-02-packages/

もう少し詳しくは以下

https://qiita.com/msi/items/d91ea3900373ff8b09d7